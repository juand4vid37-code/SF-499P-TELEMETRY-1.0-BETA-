<script>
/* ======================
   ENGINE CONTROL SYSTEM
   ====================== */

let engineOn = false;
let startTime = null;
let timerInterval = null;

function engineStart() {
  if (!engineOn) {
    engineOn = true;
    startTime = Date.now();

    document.getElementById("engineStatus").innerText = "ENGINE ON";
    document.getElementById("engineStatus").style.color = "#22c55e";
    document.getElementById("engineBtn").innerText = "ENGINE RUNNING";

    startTimer();
  }
}

function startTimer() {
  timerInterval = setInterval(() => {
    const elapsed = Date.now() - startTime;

    const hours = Math.floor(elapsed / 3600000);
    const minutes = Math.floor((elapsed % 3600000) / 60000);
    const seconds = Math.floor((elapsed % 60000) / 1000);

    document.getElementById("sessionTime").innerText =
      `${hours}h ${minutes}m ${seconds}s`;

    // Reset automÃ¡tico a 24h
    if (elapsed >= 86400000) resetDay();
  }, 1000);
}

function resetDay() {
  clearInterval(timerInterval);
  engineOn = false;

  document.getElementById("engineStatus").innerText = "ENGINE OFF";
  document.getElementById("engineStatus").style.color = "#ef4444";
  document.getElementById("engineBtn").innerText = "ENGINE START ðŸ”´";
  document.getElementById("sessionTime").innerText = "0h 0m 0s";
}

/* ======================
   TELEMETRY CSV FEED
   ====================== */

fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vSkrsRHOk7gXEjBY8ud2n-4d7a8Iq-CrC0x10W1bEwSwVswiaPj0CA3lnpdWOtPCezGkfiOX2g6Ro30/pub?output=csv")
  .then(res => res.text())
  .then(csv => {
    const lines = csv.trim().split("\n");
    const last = lines[lines.length - 1].split(",");

    document.getElementById("energy").innerText = last[1];
    document.getElementById("deepwork").innerText = last[2];
    document.getElementById("mental").innerText = last[3];
    document.getElementById("output").innerText = last[4];
    document.getElementById("streak").innerText = last[5];
  });
</script>
